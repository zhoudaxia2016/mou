{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/compile.js","webpack:///./src/directives.js","webpack:///./src/mou.js","webpack:///./src/observe.js","webpack:///./src/watcher.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;;;;;ACnEA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,KAAK;AAClB,aAAa,OAAO;AACpB;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,KAAK;AAClB;;AAEA,aAAa,IAAI,KAAK;AACtB;AACA;AACA,GAAG;;AAEH,4BAA4B;AAC5B,wBAAwB;AACxB,uBAAuB;AACvB,wBAAwB;AACxB;;AAEA;AACA,kEAAyB,2BAA2B;AACpD;;;;;;;;;;;;;;;;;ACrEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA,2BAA2B,sBAAsB;AACjD;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA,8BAA8B;AAC9B;AACA;AACA,oCAAoC;AACpC;AACA,iCAAiC;AACjC;AACA,sBAAsB,EAAE;AACxB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,8CAA8C;AAC9C,gDAAgD,SAAS,QAAQ;AACjE,kDAAkD;AAClD,gDAAgD;AAChD,gDAAgD;AAChD,2CAA2C;AAC3C,sCAAsC;AACtC,4CAA4C;;AAE5C;AACA;AACA,qDAAqD;AACrD;AACA;AACA,8CAA8C;AAC9C;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;;;AC9EA;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,uBAAuB,OAAO;AAC9B,uBAAuB,OAAO;AAC9B,uBAAuB,OAAO;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,8BAA8B;AAC3C,GAAG;AACH;AACA,oBAAoB,iBAAiB;AACrC,uBAAuB,UAAU;AACjC;AACA;AACA,KAAK;AACL,yBAAyB,eAAe,kBAAkB;AAC1D,GAAG;AACH;;AAEA;;AAEA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;;;;;;;;;;;;;;ACpDA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;;AAGA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,EAAE;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACzEA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB;;AAEA;AACA;AACA;AACA;AACA","file":"mou.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/mou.js\");\n","import Watcher from './watcher'\nimport directives from './directives.js'\n\nexport default function compile(node,data){\n  /**\n   * 模板编译函数\n   * \n   * @param {Node} node\n   * @param {Object} data\n   */\n\n\n  // 编译指令\n  compileDirectives(node, data)\n\n  // 遍历所有子节点\n  var nodes = [].slice.call(node.childNodes).filter(item => item.nodeType === 1 || item.nodeType === 3);\n  nodes.forEach(function(child){\n    // 若是元素节点，递归编译\n    if (child.nodeType === 1){\n      compile(child, data)\n    }\n\n    // 若元素是文本节点，编译为更新函数，保存到data对应的属性里面\n    else if (child.nodeType === 3){\n      compileText(child, data)\n    }\n  });\n}\n\nfunction compileDirectives (node, data) {\n  let attrs = node.attributes\n  if (attrs) {\n\n    [].slice.call(attrs).forEach(attr => {\n\n      let [name, arg] = attr.nodeName.split(':')\n      let value = attr.nodeValue\n\n      if (name in directives) {\n\tlet cb = directives[name].callback\n\tif (cb) {\n\t  cb(node, arg, value, data)\n\t}\n      }\n    })\n  }\n}\n\nfunction compileText(node,data){\n  /**\n   * 编译文本节点\n   *\n   * @param {Node} node\n   */\n\n  var p = /{{([^}]*)}}/g;\n  var text = node.nodeValue.replace(p,function(m,exp){\n    return \"`+(\" + exp + \")+`\";\n  });\n\n  var code = [\"var tmp = '';\"];\n  code.push(\"with(data){tmp = tmp + `\");\n  code.push(text + \"`};\");\n  code.push(\"return tmp;\");\n  code = code.join('');\n\n  var fn = new Function('data',code);\n  new Watcher(function(){node.nodeValue = fn(data);});\n}\n\n","import Watcher from './watcher'\nimport compile from './compile'\n\nlet directives = {}\n\n// m-show指令\ndirectives['m-show'] = {\n\n  callback (node, arg, value, data) {\n\n    let code = 'with(data){return ' + value + ';}';\n    var fn = new Function('data',code);\n\n    new Watcher(function(){\n      let show = fn(data);\n      node.style.display = show ? '' : 'none';\n    })\n  }\n}\n\n// m-on指令，事件绑定\ndirectives['m-on'] = {\n\n  callback (node, arg, value, data) {\n\n    let p = /m-on:([^.]+)(.*)?/\n\n    if (arg){\n\n      let code = ['with(data){']\n      code.push('node.addEventListener(\"')\n      code.push(arg)\n      code.push('\",function($event){if (typeof ')\n      code.push(value)\n      code.push('=== \"function\"){')\n      code.push(value)\n      code.push('();}})}')\n      code = code.join('')\n\n      let fn = new Function('node','data',code)\n      new Watcher(() => fn(node, data))\n    }\n  }\n}\n\n// m-for指令\ndirectives['m-for'] = {\n  callback (node, arg, value, data) {\n    let p = /\\s*(\\S+)\\s+in\\s+(\\S+)\\s*/\n    let item = p.exec(value)[1]\n    let list = p.exec(value)[2]\n\n    let code = ['var list = data.' + list + ';']\n    code.push('for (var z = 0,len = list.length; z < len; z ++) {')\n    code.push('var newNode = node.cloneNode(true);')\n    code.push('newNode.removeAttribute(\"m-for\");')\n    code.push('var oldValue = data.' + item + ';')\n    code.push('data.' + item + ' = list[z];')\n    code.push('compile(newNode, data);')\n    code.push('data.' + item + ' = oldValue;')\n\n    var next = node.nextElementSibling\n    if (next){\n      code.push('parent.insertBefore(newNode, next);}')\n    }\n    else {\n      code.push('parent.appendChild(newNode);}')\n    }\n\n    code = code.join('')\n    parent = node.parentNode\n    node = node.parentNode.removeChild(node)\n\n    let fn = new Function('node', 'parent', 'data', 'next', 'compile', code)\n    new Watcher(() => fn(node, parent, data, next, compile))\n  }\n}\n\nexport default directives\n","//var observe = require('./observe.js')\n//var compile = require('./compile.js')\n\nimport observe from './observe'\nimport compile from './compile'\n\nfunction Mou(options){\n  /**\n   * Mou实例对象\n   *\n   * @param {Object} options\n   *                - {String} el\n   *                - {Object} data\n   *                - {Object} methods\n   */\n\n  this.el = options.el;\n  for (var fn in options.methods){\n    options.methods[fn] = options.methods[fn].bind(options.data);\n  }\n  this.data = Object.assign(options.data,options.methods);\n  observe(this.data);\n  compile(document.querySelector(this.el),this.data);\n}\n\nvar options = {\n  el: '#app',\n  data:{\n    title:'This is a title',\n    content:'This is content!!!',\n    number: 10,\n    ok: false,\n    color: ['red','blue','green', 'black'],\n    fruits: {apple:'apple',banana:'banana'},\n  },\n  methods:{\n    get: function(){return 'Great!';},\n    print: function(a){return a;},\n    add: function(){\n      this.number ++;\n    },\n    minus: function(n,e){console.log(e);this.number -= n;},\n  },\n}\n\nvar mou = new Mou(options);\n\nmou.data.title = 'title'\nmou.data.ok = true;\nmou.data.get = function(){return 'Bad!';}\nmou.data.add = function(){\n  this.number += 5;\n}\n","//var Watcher = require('./watcher')\nimport Watcher from './watcher'\n\nexport default function(data){\n  /**\n   * 遍历data，将大data所有属性设置为响应式的\n   * \n   * @param {Object} data\n   */\n\n  if (data && typeof data === 'object'){\n    Object.keys(data).forEach(function(key){\n      defineReactive(data,key,data[key]);\n    });\n  }\n}\n\n\nfunction defineReactive(data,key,val){\n  /**\n   * 响应式属性设置的主要函数\n   *\n   * @param {Object} data\n   * @param {String} key\n   * @param {-} val\n   */\n\n  var dep = new Dep();\n  Object.defineProperty(data,key,{\n    enumerable: true,\n    configurable: false,\n    get: function(){\n      if (Watcher.tmp){\n        dep.addCb(Watcher.tmp);\n      }\n      return val;\n    },\n    set: function(newVal){\n      val = newVal;\n      dep.notify();\n    }\n  });\n  if (val && typeof val === 'object'){\n    Object.keys(val).forEach(function(k){\n      defineReactive(val,k,val[k]);\n    });\n  }\n}\n\nfunction Dep(){\n  /**\n   * 保存更新函数数组\n   */\n\n  this.watchers = [];\n}\n\nDep.prototype.notify = function(){\n  /**\n   * 通知更新函数更新\n   */\n\n  this.watchers.forEach(function(watcher){\n    watcher.update();\n  });\n};\n\nDep.prototype.addCb = function(watcher){\n  /**\n   * 添加更新函数\n   */\n\n  this.watchers.push(watcher);\n}\n","export default function Watcher(update){\n  /**\n   * 监视器，通过get添加到dep\n   *\n   * @param {Function} update\n   */\n\n  this.update = update;\n  Watcher.tmp = this;\n  this.update();\n  Watcher.tmp = null;\n}\n\n"],"sourceRoot":""}